name: Lint and Format Check

on:
  push:
    branches-ignore:
      - master
      - main
  pull_request:
    branches:
      - master
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check shell scripts
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ shell —Å–∫—Ä–∏–ø—Ç–æ–≤..."
          if command -v shellcheck >/dev/null 2>&1; then
            find . -name "*.sh" -exec shellcheck {} \;
            echo "‚úÖ Shell —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã"
          else
            echo "‚ö†Ô∏è shellcheck –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É"
          fi

      - name: Check JSON files
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Ñ–∞–π–ª–æ–≤..."
          find . -name "*.json" -exec python3 -m json.tool {} \; >/dev/null
          echo "‚úÖ JSON —Ñ–∞–π–ª—ã –≤–∞–ª–∏–¥–Ω—ã"

      - name: Check Python requirements
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ requirements.txt..."
          if [ -f requirements.txt ]; then
            python3 -m pip install --dry-run -r requirements.txt >/dev/null
            echo "‚úÖ requirements.txt –≤–∞–ª–∏–¥–µ–Ω"
          else
            echo "‚ö†Ô∏è requirements.txt –Ω–µ –Ω–∞–π–¥–µ–Ω"
          fi

      - name: Check Dockerfile syntax
        uses: hadolint/hadolint-action@v3.1.0
        with:
          dockerfile: Dockerfile
          failure-threshold: warning